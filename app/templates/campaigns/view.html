{% extends "base.html" %}

{% block title %}{{ campaign.name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-6">
        <a href="/campaigns" class="text-indigo-600 hover:text-indigo-500 text-sm">&larr; Back to Campaigns</a>
    </div>

    {% if error %}
    <div class="mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
        {{ error }}
    </div>
    {% endif %}

    {% if success %}
    <div class="mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded">
        {{ success }}
    </div>
    {% endif %}

    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:p-6">
            <div class="flex justify-between items-start">
                <div>
                    <div class="flex items-center">
                        <h1 class="text-2xl font-semibold text-gray-900">{{ campaign.name }}</h1>
                        <span class="ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            {% if campaign.status.value == 'active' %}bg-green-100 text-green-800
                            {% elif campaign.status.value == 'paused' %}bg-yellow-100 text-yellow-800
                            {% elif campaign.status.value == 'completed' %}bg-blue-100 text-blue-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ campaign.status.value|title }}
                        </span>
                    </div>
                    <p class="mt-2 text-gray-600">{{ campaign.topic }}</p>
                </div>
                <div class="flex space-x-2">
                    {% if campaign.status.value == 'active' %}
                    <form action="/campaigns/{{ campaign.id }}/pause" method="post" class="inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="px-3 py-2 border border-yellow-300 rounded-md text-sm font-medium text-yellow-700 bg-yellow-50 hover:bg-yellow-100">
                            Pause
                        </button>
                    </form>
                    {% elif campaign.status.value == 'paused' %}
                    <form action="/campaigns/{{ campaign.id }}/resume" method="post" class="inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="px-3 py-2 border border-green-300 rounded-md text-sm font-medium text-green-700 bg-green-50 hover:bg-green-100">
                            Resume
                        </button>
                    </form>
                    {% endif %}
                    {% if campaign.status.value in ['active', 'paused'] %}
                    <form action="/campaigns/{{ campaign.id }}/cancel" method="post" class="inline" onsubmit="return confirm('Are you sure you want to cancel this campaign?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="px-3 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100">
                            Cancel
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            <!-- Stats -->
            <div class="mt-6 grid grid-cols-2 gap-4 sm:grid-cols-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-sm text-gray-500">Total Tweets</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ stats.total }}</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <p class="text-sm text-green-600">Posted</p>
                    <p class="text-2xl font-semibold text-green-700">{{ stats.posted }}</p>
                </div>
                <div class="bg-blue-50 rounded-lg p-4">
                    <p class="text-sm text-blue-600">Scheduled</p>
                    <p class="text-2xl font-semibold text-blue-700">{{ stats.awaiting_generation }}</p>
                </div>
                <div class="bg-red-50 rounded-lg p-4">
                    <p class="text-sm text-red-600">Failed</p>
                    <p class="text-2xl font-semibold text-red-700">{{ stats.failed }}</p>
                </div>
            </div>

            <!-- Progress -->
            <div class="mt-6">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Progress</span>
                    <span>{{ stats.progress_percentage|round(1) }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="bg-indigo-600 h-3 rounded-full transition-all" style="width: {{ stats.progress_percentage }}%"></div>
                </div>
            </div>

            <!-- Campaign Details -->
            <div class="mt-6 border-t border-gray-200 pt-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Campaign Details</h3>
                <dl class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                    <div>
                        <dt class="text-sm text-gray-500">Frequency</dt>
                        <dd class="text-sm text-gray-900">{{ campaign.frequency_per_day }} tweets/day</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-500">Duration</dt>
                        <dd class="text-sm text-gray-900">{{ campaign.duration_days }} days</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-500">Tone</dt>
                        <dd class="text-sm text-gray-900 capitalize">{{ campaign.tone.value }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-500">Posting Hours</dt>
                        <dd class="text-sm text-gray-900">{{ '%02d:00'|format(campaign.posting_start_hour) }} - {{ '%02d:00'|format(campaign.posting_end_hour) }} ({{ campaign.timezone }})</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-500">Start Date</dt>
                        <dd class="text-sm text-gray-900">{{ campaign.start_date.strftime('%Y-%m-%d') }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-500">End Date</dt>
                        <dd class="text-sm text-gray-900">{{ campaign.end_date.strftime('%Y-%m-%d') }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm text-gray-500">Web Search</dt>
                        <dd class="text-sm text-gray-900">{{ 'Enabled' if campaign.web_search_enabled else 'Disabled' }}</dd>
                    </div>
                    {% if campaign.search_keywords %}
                    <div>
                        <dt class="text-sm text-gray-500">Search Keywords</dt>
                        <dd class="text-sm text-gray-900">{{ campaign.search_keywords|join(', ') }}</dd>
                    </div>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>

    <!-- Recent Tweets -->
    <div class="mt-6 bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center">
            <h2 class="text-lg font-medium text-gray-900">Recent Tweets</h2>
            <a href="/campaigns/{{ campaign.id }}/tweets" class="text-indigo-600 hover:text-indigo-500 text-sm">View All</a>
        </div>
        <ul class="divide-y divide-gray-200">
            {% if recent_tweets %}
            {% for tweet in recent_tweets %}
            <li class="px-4 py-4">
                <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                        {% if tweet.content %}
                        <p class="text-sm text-gray-900">{{ tweet.content[:150] }}{% if tweet.content|length > 150 %}...{% endif %}</p>
                        {% else %}
                        <p class="text-sm text-gray-400 italic">Content will be generated at posting time</p>
                        {% endif %}
                        <div class="mt-1 flex items-center space-x-2">
                            <span class="text-xs px-2 py-0.5 rounded-full
                                {% if tweet.status.value == 'posted' %}bg-green-100 text-green-800
                                {% elif tweet.status.value == 'awaiting_generation' %}bg-blue-100 text-blue-800
                                {% elif tweet.status.value == 'failed' %}bg-red-100 text-red-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ tweet.status.value.replace('_', ' ')|title }}
                            </span>
                            <span class="text-xs text-gray-500">
                                {% if tweet.status.value == 'posted' and tweet.posted_at %}
                                Posted: {{ tweet.posted_at.strftime('%Y-%m-%d %H:%M') }} UTC
                                {% else %}
                                Scheduled: {{ tweet.scheduled_for.strftime('%Y-%m-%d %H:%M') }} UTC
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% if tweet.twitter_tweet_id %}
                    <a href="https://twitter.com/i/status/{{ tweet.twitter_tweet_id }}" target="_blank" class="ml-4 text-blue-500 hover:text-blue-600 text-sm">
                        View on X
                    </a>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
            {% else %}
            <li class="px-4 py-8 text-center text-gray-500">
                No tweets yet
            </li>
            {% endif %}
        </ul>
    </div>

    <!-- Delete Campaign -->
    {% if campaign.status.value in ['completed', 'cancelled'] %}
    <div class="mt-6 bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-medium text-red-600 mb-2">Danger Zone</h3>
        <p class="text-sm text-gray-500 mb-4">Once you delete a campaign, there is no going back. Please be certain.</p>
        <form action="/campaigns/{{ campaign.id }}/delete" method="post" onsubmit="return confirm('Are you sure you want to permanently delete this campaign?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="px-4 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100">
                Delete Campaign
            </button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
