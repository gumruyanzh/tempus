{% extends "base.html" %}

{% block title %}{{ strategy.name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-6">
        <a href="/growth" class="text-indigo-600 hover:text-indigo-500 text-sm">&larr; Back to Growth Strategies</a>
    </div>

    {% if error %}
    <div class="mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
        {{ error }}
    </div>
    {% endif %}

    {% if success %}
    <div class="mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded">
        {{ success }}
    </div>
    {% endif %}

    <!-- Header -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:p-6">
            <div class="flex justify-between items-start">
                <div>
                    <div class="flex items-center">
                        <h1 class="text-2xl font-semibold text-gray-900">{{ strategy.name }}</h1>
                        <span class="ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            {% if strategy.status.value == 'active' %}bg-green-100 text-green-800
                            {% elif strategy.status.value == 'paused' %}bg-yellow-100 text-yellow-800
                            {% elif strategy.status.value == 'completed' %}bg-blue-100 text-blue-800
                            {% elif strategy.status.value == 'draft' %}bg-gray-100 text-gray-800
                            {% else %}bg-red-100 text-red-800{% endif %}">
                            {{ strategy.status.value|title }}
                        </span>
                        {% if strategy.verification_status.value != 'none' %}
                        <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                            {% if strategy.verification_status.value == 'blue' %}bg-blue-50 text-blue-600
                            {% else %}bg-yellow-50 text-yellow-600{% endif %}">
                            {{ strategy.verification_status.value|title }}
                        </span>
                        {% endif %}
                    </div>
                    <p class="mt-2 text-gray-600">{{ strategy.original_prompt }}</p>
                </div>
                <div class="flex space-x-2">
                    {% if strategy.status.value == 'active' %}
                    <form action="/growth/{{ strategy.id }}/pause" method="post" class="inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="px-3 py-2 border border-yellow-300 rounded-md text-sm font-medium text-yellow-700 bg-yellow-50 hover:bg-yellow-100">
                            Pause
                        </button>
                    </form>
                    {% elif strategy.status.value == 'paused' %}
                    <form action="/growth/{{ strategy.id }}/resume" method="post" class="inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="px-3 py-2 border border-green-300 rounded-md text-sm font-medium text-green-700 bg-green-50 hover:bg-green-100">
                            Resume
                        </button>
                    </form>
                    {% endif %}
                    {% if strategy.status.value in ['active', 'paused'] %}
                    <form action="/growth/{{ strategy.id }}/cancel" method="post" class="inline" onsubmit="return confirm('Are you sure you want to cancel this strategy?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="px-3 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100">
                            Cancel
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="mt-6 grid grid-cols-2 gap-4 sm:grid-cols-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-sm text-gray-500">Starting Followers</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ strategy.starting_followers }}</p>
                </div>
                <div class="bg-indigo-50 rounded-lg p-4">
                    <p class="text-sm text-indigo-600">Current Followers</p>
                    <p class="text-2xl font-semibold text-indigo-700">{{ strategy.current_followers }}</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <p class="text-sm text-green-600">Gained</p>
                    <p class="text-2xl font-semibold text-green-700">+{{ strategy.followers_gained }}</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4">
                    <p class="text-sm text-purple-600">Target</p>
                    <p class="text-2xl font-semibold text-purple-700">{{ strategy.target_followers }}</p>
                </div>
            </div>

            <!-- Progress -->
            <div class="mt-6">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Progress to Target</span>
                    {% set progress = ((strategy.current_followers - strategy.starting_followers) / (strategy.target_followers - strategy.starting_followers) * 100) if strategy.target_followers > strategy.starting_followers else 0 %}
                    <span>{{ "%.1f"|format(progress) }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="bg-indigo-600 h-3 rounded-full transition-all" style="width: {{ [progress, 100]|min }}%"></div>
                </div>
            </div>

            <!-- Day Progress -->
            <div class="mt-4">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Timeline</span>
                    <span>Day {{ analytics.days_elapsed }} of {{ strategy.duration_days }}</span>
                </div>
                {% set time_progress = (analytics.days_elapsed / strategy.duration_days * 100) if strategy.duration_days > 0 else 0 %}
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gray-500 h-2 rounded-full" style="width: {{ [time_progress, 100]|min }}%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Engagement Stats -->
    <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white shadow rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-blue-100 rounded-lg">
                    <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500">Follows</p>
                    <p class="text-xl font-semibold text-gray-900">{{ strategy.total_follows }}</p>
                </div>
            </div>
        </div>
        <div class="bg-white shadow rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-red-100 rounded-lg">
                    <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500">Likes</p>
                    <p class="text-xl font-semibold text-gray-900">{{ strategy.total_likes }}</p>
                </div>
            </div>
        </div>
        <div class="bg-white shadow rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-green-100 rounded-lg">
                    <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500">Retweets</p>
                    <p class="text-xl font-semibold text-gray-900">{{ strategy.total_retweets }}</p>
                </div>
            </div>
        </div>
        <div class="bg-white shadow rounded-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-purple-100 rounded-lg">
                    <svg class="h-6 w-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500">Replies</p>
                    <p class="text-xl font-semibold text-gray-900">{{ strategy.total_replies }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Rate Limits -->
    <div class="mt-6 bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Today's Rate Limits</h2>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                {% for action, stats in rate_usage.items() %}
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-500 capitalize">{{ action }}</span>
                        <span class="text-gray-900">{{ stats.used }}/{{ stats.limit }}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="h-2 rounded-full {% if stats.percentage >= 80 %}bg-red-500{% elif stats.percentage >= 50 %}bg-yellow-500{% else %}bg-green-500{% endif %}"
                             style="width: {{ [stats.percentage, 100]|min }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
        <a href="/growth/{{ strategy.id }}/analytics" class="bg-white shadow rounded-lg p-4 hover:shadow-md transition-shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-indigo-100 rounded-lg">
                    <svg class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-900">Analytics</p>
                    <p class="text-sm text-gray-500">View detailed metrics</p>
                </div>
            </div>
        </a>
        <a href="/growth/{{ strategy.id }}/targets" class="bg-white shadow rounded-lg p-4 hover:shadow-md transition-shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-green-100 rounded-lg">
                    <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-900">Targets ({{ pending_count }} pending)</p>
                    <p class="text-sm text-gray-500">View engagement queue</p>
                </div>
            </div>
        </a>
        <a href="/growth/{{ strategy.id }}/logs" class="bg-white shadow rounded-lg p-4 hover:shadow-md transition-shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0 p-2 bg-yellow-100 rounded-lg">
                    <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-900">Activity Log</p>
                    <p class="text-sm text-gray-500">View action history</p>
                </div>
            </div>
        </a>
    </div>

    <!-- Strategy Details -->
    <div class="mt-6 bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Strategy Configuration</h2>
        </div>
        <div class="px-4 py-5 sm:p-6">
            <dl class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                <div>
                    <dt class="text-sm text-gray-500">Duration</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.duration_days }} days</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Daily Follows</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.daily_follows }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Daily Likes</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.daily_likes }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Daily Retweets</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.daily_retweets }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Daily Replies</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.daily_replies }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Active Hours</dt>
                    <dd class="text-sm text-gray-900">{{ '%02d:00'|format(strategy.engagement_hours_start) }} - {{ '%02d:00'|format(strategy.engagement_hours_end) }} ({{ strategy.timezone }})</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Start Date</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.start_date.strftime('%Y-%m-%d') }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">End Date</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.end_date.strftime('%Y-%m-%d') }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500">Tweet Limit</dt>
                    <dd class="text-sm text-gray-900">{{ strategy.tweet_char_limit }} characters</dd>
                </div>
            </dl>

            {% if strategy.niche_keywords %}
            <div class="mt-6">
                <dt class="text-sm text-gray-500 mb-2">Niche Keywords</dt>
                <dd class="flex flex-wrap gap-2">
                    {% for keyword in strategy.niche_keywords %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                        {{ keyword }}
                    </span>
                    {% endfor %}
                </dd>
            </div>
            {% endif %}

            {% if strategy.target_accounts %}
            <div class="mt-4">
                <dt class="text-sm text-gray-500 mb-2">Target Accounts</dt>
                <dd class="flex flex-wrap gap-2">
                    {% for account in strategy.target_accounts %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        @{{ account }}
                    </span>
                    {% endfor %}
                </dd>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Delete Strategy -->
    {% if strategy.status.value in ['completed', 'cancelled'] %}
    <div class="mt-6 bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-medium text-red-600 mb-2">Danger Zone</h3>
        <p class="text-sm text-gray-500 mb-4">Once you delete a strategy, there is no going back. Please be certain.</p>
        <form action="/growth/{{ strategy.id }}/delete" method="post" onsubmit="return confirm('Are you sure you want to permanently delete this strategy?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="px-4 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100">
                Delete Strategy
            </button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}
